{% extends 'core/base.html' %}
{% load static %}
{% block content %}
    <main class="mt-0 md:mt-8">
        <div class="flex flex-col lg:flex-row px-4 md:px-10 gap-5 pb-20">
            <!-- Sidebar: Related Posts -->
            <div class="lg:w-3/12 h-fit order-2 md:order-1">
                <div class="flex gap-x-2 justify-between items-center mb-4">
                    <div class="h-[1px] w-full bg-gradient-to-r from-white via-zinc-300 to-white">
                    </div>
                    <div class="w-48 min-w-fit text-zinc-700 md:font-yekanBakhBold md:text-lg">
                        مطالب مرتبط
                    </div>
                    <div class="h-[1px] w-full bg-gradient-to-r from-white via-zinc-300 to-white">
                    </div>
                </div>
                <div class="border border-zinc-300 rounded-3xl p-3 space-y-8">
                    {% for related_post in related_posts %}
                    <div class="transition group">
                        <a class="image-box block overflow-hidden rounded-lg md:rounded-2xl" href="{% url 'blog_detail' related_post.pk %}">
                            {% if related_post.image %}
                                <img alt="{{ related_post.title }}"
                                     class="rounded-2xl w-full transition-transform duration-300 ease-in-out group-hover:rotate-3 group-hover:scale-110 lazyload"
                                     src="{{ related_post.image.url }}">
                            {% else %}
                                <img alt="{{ related_post.title }}"
                                     class="rounded-2xl w-full transition-transform duration-300 ease-in-out group-hover:rotate-3 group-hover:scale-110 lazyload bg-gray-100"
                                     src='{% static "./assets/image/placeholder.svg" %}'>
                            {% endif %}
                        </a>
                        <div class="p-2 mt-2">
                            <a class="text-xs md:text-sm font-normal md:font-semibold h-8 lg:h-10 line-clamp-2 text-zinc-700"
                               href="{% url 'blog_detail' related_post.pk %}">
                                {{ related_post.title }}
                            </a>
                            <div class="flex justify-between mt-8">
                                <div class="text-xs flex gap-x-1 items-center text-zinc-400">
                                    <svg class="fill-zinc-400" fill="" height="16" viewbox="0 0 256 256" width="16"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M208,32H184V24a8,8,0,0,0-16,0v8H88V24a8,8,0,0,0-16,0v8H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM72,48v8a8,8,0,0,0,16,0V48h80v8a8,8,0,0,0,16,0V48h24V80H48V48ZM208,208H48V96H208V208Z"></path>
                                    </svg>
                                    {{ related_post.jalali_created }}
                                </div>
                                <a class="flex justify-center items-center gap-x-1 group w-fit text-xs md:text-sm transition text-zinc-600 group-hover:text-zinc-700"
                                   href="{% url 'blog_detail' related_post.pk %}">
                                    ادامه مطلب
                                    <svg class="fill-zinc-600 transition group-hover:fill-zinc-700 size-2 md:size-4"
                                         fill="" height="14" viewbox="0 0 256 256" width="14"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z"></path>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center text-zinc-500 text-sm py-10">
                        پست مرتبطی وجود ندارد
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Main Content: Blog Post -->
            <div class="lg:w-9/12 order-1 md:order-2">
                <!-- Breadcrumb -->
                <div class="mb-7 text-xs flex flex-wrap space-y-2 md:space-y-0 items-center gap-x-2 opacity-90">
                    <a class="text-zinc-500 hover:text-primary-500 transition" href="{% url 'blog' %}">
                        بلاگ
                    </a>
                    {% if post.category %}
                    <svg class="size-3 fill-zinc-500" fill="#3d3d3d" height="16" viewbox="0 0 256 256" width="16"
                         xmlns="http://www.w3.org/2000/svg">
                        <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
                    </svg>
                    <a class="text-zinc-500 hover:text-primary-500 transition" href="{% url 'blog' %}?category={{ post.category.slug }}">
                        {{ post.category.name }}
                    </a>
                    {% endif %}
                    <svg class="size-3 fill-zinc-500" fill="#3d3d3d" height="16" viewbox="0 0 256 256" width="16"
                         xmlns="http://www.w3.org/2000/svg">
                        <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
                    </svg>
                    <span class="text-primary-500">
                        {{ post.title }}
                    </span>
                </div>
                <!-- Post Content -->
                <div class="border border-zinc-300 rounded-3xl p-1.5 md:p-3">
                    {% if post.image %}
                    <img alt="{{ post.title }}" class="w-full h-72 md:h-96 rounded-3xl object-cover object-center mb-3.5"
                         src="{{ post.image.url }}"/>
                    {% else %}
                    <img alt="{{ post.title }}" class="w-full h-72 md:h-96 rounded-3xl object-cover object-center mb-3.5 bg-gray-100"
                         src='{% static "./assets/image/placeholder.svg" %}'/>
                    {% endif %}
                    <div class="flex gap-4 mb-10 flex-wrap">
                        <div class="text-xs flex gap-x-1 items-center text-zinc-400">
                            <svg class="fill-zinc-400" fill="" height="16" viewbox="0 0 256 256" width="16"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M208,32H184V24a8,8,0,0,0-16,0v8H88V24a8,8,0,0,0-16,0v8H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM72,48v8a8,8,0,0,0,16,0V48h80v8a8,8,0,0,0,16,0V48h24V80H48V48ZM208,208H48V96H208V208Z"></path>
                            </svg>
                            {{ post.jalali_created }}
                        </div>
                        {% if post.author %}
                        <div class="text-xs flex gap-x-1 items-center text-zinc-400">
                            <svg class="fill-zinc-400" fill="#000000" height="16" viewbox="0 0 256 256" width="16"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24ZM74.08,197.5a64,64,0,0,1,107.84,0,87.83,87.83,0,0,1-107.84,0ZM96,120a32,32,0,1,1,32,32A32,32,0,0,1,96,120Zm97.76,66.41a79.66,79.66,0,0,0-36.06-28.75,48,48,0,1,0-59.4,0,79.66,79.66,0,0,0-36.06,28.75,88,88,0,1,1,131.52,0Z"></path>
                            </svg>
                            نوشته شده توسط {{ post.author.fullname|default:post.author.phone }}
                        </div>
                        {% endif %}
                        {% if post.category %}
                        <div class="text-xs flex gap-x-1 items-center text-zinc-400">
                            <svg class="fill-zinc-400" fill="#000000" height="16" viewbox="0 0 256 256" width="16"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M224,64H154.67L126.93,43.2a16.12,16.12,0,0,0-9.6-3.2H72A16,16,0,0,0,56,56V72H40A16,16,0,0,0,24,88V200a16,16,0,0,0,16,16H192.89A15.13,15.13,0,0,0,208,200.89V184h16.89A15.13,15.13,0,0,0,240,168.89V80A16,16,0,0,0,224,64ZM192,200H40V88H85.33l27.74,20.8a16.12,16.12,0,0,0,9.6,3.2H192Zm32-32H208V112a16,16,0,0,0-16-16H122.67L94.93,75.2a16.12,16.12,0,0,0-9.6-3.2H72V56h45.33l27.74,20.8a16.12,16.12,0,0,0,9.6,3.2H224Z"></path>
                            </svg>
                            دسته بندی
                            <a class="hover:text-primary-400 transition" href="{% url 'blog' %}?category={{ post.category.slug }}">
                                {{ post.category.name }}
                            </a>
                        </div>
                        {% endif %}
                        <div class="text-xs flex gap-x-1 items-center text-zinc-400">
                            <svg class="fill-zinc-400" fill="#000000" height="16" viewbox="0 0 256 256" width="16"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M247.31,124.76c-.35-.79-8.82-19.58-27.65-38.41C194.57,61.26,162.88,48,128,48S61.43,61.26,36.34,86.35C17.51,105.18,9,124,8.69,124.76a8,8,0,0,0,0,6.5c.35.79,8.82,19.57,27.65,38.4C61.43,194.74,93.12,208,128,208s66.57-13.26,91.66-38.34c18.83-18.83,27.3-37.61,27.65-38.4A8,8,0,0,0,247.31,124.76ZM128,192c-30.78,0-57.67-11.19-79.93-33.25A133.47,133.47,0,0,1,25,128,133.33,133.33,0,0,1,48.07,97.25C70.33,75.19,97.22,64,128,64s57.67,11.19,79.93,33.25A133.46,133.46,0,0,1,231.05,128C223.84,141.46,192.43,192,128,192Zm0-112a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Z"></path>
                            </svg>
                            {{ post.views }} بازدید
                        </div>
                    </div>
                    <!-- Post Title -->
                    <h1 class="text-xl md:text-3xl text-zinc-800 font-yekanBakhBold my-6 text-center">
                        {{ post.title }}
                    </h1>
                    <!-- Post Excerpt -->
                    {% if post.excerpt %}
                    <div class="text-sm md:text-base text-zinc-600 mb-6 text-center italic">
                        {{ post.excerpt }}
                    </div>
                    {% endif %}
                    <!-- Post Content -->
                    <div class="post-content text-xs md:text-sm text-zinc-700 leading-8 text-justify">
                        {{ post.content|linebreaks }}
                    </div>
                </div>
                <!-- Comment Form -->
                {% if user.is_authenticated %}
                <div class="mt-10 border border-zinc-300 rounded-3xl p-4 md:p-6">
                    <h2 class="text-lg md:text-xl font-yekanBakhBold text-zinc-800 mb-6">
                        ثبت دیدگاه
                    </h2>
                    {% if messages %}
                        {% for message in messages %}
                        <div class="mb-4 p-3 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-700 border border-green-200{% elif message.tags == 'error' %}bg-red-50 text-red-700 border border-red-200{% else %}bg-blue-50 text-blue-700 border border-blue-200{% endif %}">
                            {{ message }}
                        </div>
                        {% endfor %}
                    {% endif %}
                    <form method="post" action="{% url 'blog_detail' post.pk %}">
                        {% csrf_token %}
                        {{ comment_form.content }}
                        {% if comment_form.content.errors %}
                        <div class="mt-2 text-sm text-red-600">
                            {{ comment_form.content.errors }}
                        </div>
                        {% endif %}
                        <button type="submit" class="mt-4 w-full md:w-auto px-6 py-3 text-sm bg-gradient-to-bl from-primary-500 to-primary-400 hover:opacity-90 transition text-gray-100 rounded-lg">
                            ارسال دیدگاه
                        </button>
                    </form>
                </div>
                {% else %}
                <div class="mt-10 border border-zinc-300 rounded-3xl p-4 md:p-6 text-center">
                    <p class="text-zinc-600 mb-4">برای ثبت دیدگاه باید وارد شوید</p>
                    <a href="{% url 'dashboard-details' %}" class="text-primary-500 hover:text-primary-600 transition">
                        ورود / ثبت نام
                    </a>
                </div>
                {% endif %}
                <!-- Comments Section -->
                <div class="mt-10 border border-zinc-300 rounded-3xl p-4 md:p-6">
                    <h2 class="text-lg md:text-xl font-yekanBakhBold text-zinc-800 mb-6">
                        دیدگاه‌ها ({{ comments.count }})
                    </h2>
                    {% if comments %}
                    <div class="space-y-6">
                        {% for comment in comments %}
                        <div class="border-b border-zinc-200 pb-6 last:border-0">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="text-sm font-semibold text-zinc-800">
                                    {{ comment.author.fullname|default:comment.author.phone }}
                                </div>
                                <div class="text-xs text-zinc-400">
                                    {{ comment.jalali_created }}
                                </div>
                            </div>
                            <p class="text-sm text-zinc-700 leading-7">
                                {{ comment.content }}
                            </p>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center text-zinc-500 py-10">
                        <p>هنوز دیدگاهی ثبت نشده است. اولین دیدگاه را شما ثبت کنید!</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </main>
{% endblock %}
