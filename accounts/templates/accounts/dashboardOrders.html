{% extends 'accounts/dashboard_base.html' %}
{% load static %}
{% load humanize %}
{% block content %}
    <main class="p-6 flex-1 overflow-y-auto">
        <div class="bg-white dark:bg-zinc-900 rounded-2xl min-h-80 h-auto shadow-custom p-4 transition-colors duration-300">
            <div class="px-2 md:px-3 pt-3 pb-5 mb-3 text-zinc-700 dark:text-zinc-200 text-sm md:text-base flex items-center gap-x-2 border-b border-zinc-200 dark:border-zinc-700">
                <svg class="fill-primary-500" fill="currentColor" height="20" viewbox="0 0 256 256" width="20"
                     xmlns="http://www.w3.org/2000/svg">
                    <path d="M128,16a88.1,88.1,0,0,0-88,88c0,75.3,80,132.17,83.41,134.55a8,8,0,0,0,9.18,0C136,236.17,216,179.3,216,104A88.1,88.1,0,0,0,128,16Zm0,56a32,32,0,1,1-32,32A32,32,0,0,1,128,72Z"></path>
                </svg>
                سفارشات
            </div>
            <div class="relative flex flex-col w-full h-full overflow-scroll text-gray-700 dark:text-zinc-100">
                <div class="mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800/40 rounded-lg text-sm text-yellow-800 dark:text-yellow-200">
                    <p class="font-yekanBakhBold mb-1">⚠️ توجه:</p>
                    <p>سفارش‌هایی که بیش از یک ساعت در وضعیت "در انتظار پرداخت" باشند، به صورت خودکار لغو می‌شوند.</p>
                </div>
                <table class="w-full text-right table-auto min-w-max">
                    <thead>
                    <tr>
                        <th class="p-4 border-b border-b-zinc-400 dark:border-b-zinc-700">
                            <p class="block text-sm opacity-70 dark:text-zinc-300">
                                شماره سفارش
                            </p>
                        </th>
                        <th class="p-4 border-b border-b-zinc-400 dark:border-b-zinc-700">
                            <p class="block text-sm opacity-70 dark:text-zinc-300">
                                تاریخ
                            </p>
                        </th>
                        <th class="p-4 border-b border-b-zinc-400 dark:border-b-zinc-700">
                            <p class="block text-sm opacity-70 dark:text-zinc-300">
                                مبلغ
                            </p>
                        </th>
                        <th class="p-4 border-b border-b-zinc-400 dark:border-b-zinc-700">
                            <p class="block text-sm opacity-70 dark:text-zinc-300">
                                وضعیت
                            </p>
                        </th>
                        <th class="p-4 border-b border-b-zinc-400 dark:border-b-zinc-700">
                            <p class="block text-sm opacity-70 dark:text-zinc-300">
                                جزئیات
                            </p>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for order in orders %}
                    <tr class="even:bg-zinc-100">
                        <td class="p-4">
                            <p class="block text-sm">
                                #{{ order.order_number }}
                            </p>
                        </td>
                        <td class="p-4">
                            <p class="block text-sm">
                                {{ order.jalali_created }}
                            </p>
                        </td>
                        <td class="p-4">
                            <p class="block text-sm">
                                {{ order.get_final_price|intcomma }} تومان
                            </p>
                        </td>
                        <td class="p-4">
                            <div class="flex items-center gap-2">
                                <p class="block text-sm">
                                    {{ order.get_status_display }}
                                </p>
                                {% if order.status == 'pending' and not order.payment_status and not order.is_pending_payment_expired %}
                                <a href="{% url 'retry_payment' order.id %}" 
                                   class="inline-block bg-green-500 hover:bg-green-600 text-white text-xs px-3 py-1 rounded transition-colors">
                                    پرداخت
                                </a>
                                {% endif %}
                            </div>
                        </td>
                        <td class="p-4">
                            <a class="block text-xs text-primary-500 dark:text-primary-400" href="{% url 'dashboard-order-details' order.id %}">مشاهده</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="p-4 text-center text-zinc-500 dark:text-zinc-400">
                            سفارشی ثبت نشده است
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </main>
{% endblock %}