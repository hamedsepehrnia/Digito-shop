{% load static %}
<!DOCTYPE html>

<html class="scroll-smooth" dir="rtl" lang="fa">

<head>
    <meta charset="utf-8"/>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <link href='{% static "./assets/image/fav.png" %}' rel="icon" type="image/x-icon"/>
    <link href='{% static "./assets/css/main.css" %}' rel="stylesheet"/>
    <title>فروشگاه آنلاین دیجیتو</title>
    <script>
        (function() {
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
                document.documentElement.style.backgroundColor = '#111111';
                document.body.style.backgroundColor = '#111111';
                document.body.style.color = '#ffffff';
            }
        })();
    </script>
</head>
<body class="max-w-[1700px] mx-auto bg-zinc-100 dark:bg-[#111111] text-zinc-800 dark:text-zinc-100 flex flex-col min-h-screen relative transition-colors duration-300">
<!-- bg blur mobile -->
<div class="fixed z-10 inset-0 bg-black/35 hidden transition-opacity duration-300" id="overlay"></div>
<!-- Sidebar -->
<div class="z-20 fixed top-0 right-0 w-10/12 md:w-6/12 lg:w-[17%] h-screen bg-white dark:bg-zinc-900 shadow-lg dark:shadow-zinc-800/50 transform translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out"
     id="mobile-menu">
    <div class="p-5 flex flex-col gap-y-3 justify-center items-center">
        <!-- logo -->
        <div class="flex justify-center">
            <a href="/">
                <img alt="" class="max-w-24 md:max-w-28 h-fit" src='{% static "./assets/image/logo.png" %}'/>
            </a>
        </div>
    </div>
    <ul class="p-5 space-y-1 text-sm text-zinc-800 dark:text-zinc-200 overflow-y-auto pb-48">
        <li>
            <a class="py-3 px-4 hover:bg-gradient-to-l hover:from-zinc-100 hover:to-transparent dark:hover:bg-zinc-800 rounded-lg flex gap-x-2 transition-colors"
               href={% url 'dashboard' %}>
                <svg class="text-zinc-600 dark:text-zinc-300" fill="currentColor" height="18" viewbox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
                    <path
                          d="M11.25 18C11.25 18.1989 11.329 18.3897 11.4697 18.5303C11.6103 18.671 11.8011 18.75 12 18.75C12.1989 18.75 12.3897 18.671 12.5303 18.5303C12.671 18.3897 12.75 18.1989 12.75 18V15C12.75 14.8011 12.671 14.6103 12.5303 14.4697C12.3897 14.329 12.1989 14.25 12 14.25C11.8011 14.25 11.6103 14.329 11.4697 14.4697C11.329 14.6103 11.25 14.8011 11.25 15V18Z"
                          fill=""></path>
                    <path class="fill-gray-700" clip-rule="evenodd"
                          d="M12 1.25C11.292 1.25 10.649 1.453 9.95 1.792C9.276 2.12 8.496 2.604 7.523 3.208L5.456 4.491C4.536 5.063 3.797 5.521 3.229 5.956C2.64 6.406 2.188 6.866 1.861 7.463C1.535 8.058 1.389 8.692 1.318 9.441C1.25 10.166 1.25 11.054 1.25 12.167V13.78C1.25 15.684 1.25 17.187 1.403 18.362C1.559 19.567 1.889 20.54 2.633 21.309C3.38 22.082 4.33 22.428 5.508 22.591C6.648 22.75 8.106 22.75 9.942 22.75H14.058C15.894 22.75 17.352 22.75 18.492 22.591C19.669 22.428 20.62 22.082 21.368 21.309C22.111 20.54 22.441 19.567 22.598 18.362C22.75 17.187 22.75 15.684 22.75 13.78V12.167C22.75 11.054 22.75 10.167 22.682 9.441C22.612 8.691 22.465 8.058 22.139 7.463C21.812 6.866 21.359 6.407 20.771 5.956C20.203 5.52 19.465 5.063 18.544 4.491L16.477 3.208C15.504 2.604 14.724 2.12 14.049 1.792C13.352 1.452 12.709 1.25 12 1.25ZM8.28 4.504C9.295 3.874 10.01 3.432 10.607 3.141C11.188 2.858 11.6 2.75 12 2.75C12.4 2.75 12.812 2.858 13.393 3.141C13.991 3.431 14.705 3.874 15.72 4.504L17.72 5.745C18.681 6.342 19.356 6.761 19.86 7.147C20.349 7.522 20.63 7.831 20.823 8.183C21.016 8.536 21.129 8.949 21.188 9.581C21.249 10.229 21.25 11.046 21.25 12.204V13.725C21.25 15.695 21.248 17.101 21.11 18.168C20.974 19.216 20.717 19.824 20.29 20.267C19.865 20.706 19.287 20.967 18.286 21.106C17.26 21.248 15.907 21.25 14 21.25H10C8.092 21.25 6.74 21.248 5.714 21.106C4.713 20.966 4.135 20.706 3.711 20.266C3.283 19.824 3.026 19.216 2.891 18.168C2.751 17.101 2.75 15.696 2.75 13.725V12.204C2.75 11.046 2.75 10.229 2.812 9.581C2.871 8.949 2.984 8.536 3.177 8.183C3.37 7.831 3.651 7.522 4.141 7.147C4.644 6.761 5.319 6.342 6.28 5.745L8.28 4.504Z"
                          fill="" fill-rule="evenodd"></path>
                </svg>
                صفحه اصلی
            </a>
        </li>
        <li>
            <a class="py-3 px-4 hover:bg-gradient-to-l hover:from-zinc-100 hover:to-transparent dark:hover:bg-zinc-800 rounded-lg flex gap-x-2 transition-colors"
               href={% url 'dashboard-orders' %}>
                <svg class="text-zinc-600 dark:text-zinc-300" fill="currentColor" height="20" viewbox="0 0 256 256" width="20"
                     xmlns="http://www.w3.org/2000/svg">
                    <path d="M104,216a16,16,0,1,1-16-16A16,16,0,0,1,104,216Zm88-16a16,16,0,1,0,16,16A16,16,0,0,0,192,200ZM239.71,74.14l-25.64,92.28A24.06,24.06,0,0,1,191,184H92.16A24.06,24.06,0,0,1,69,166.42L33.92,40H16a8,8,0,0,1,0-16H40a8,8,0,0,1,7.71,5.86L57.19,64H232a8,8,0,0,1,7.71,10.14ZM221.47,80H61.64l22.81,82.14A8,8,0,0,0,92.16,168H191a8,8,0,0,0,7.71-5.86Z"></path>
                </svg>
                سفارشات
            </a>
        </li>
        <li>
            <a class="py-3 px-4 hover:bg-gradient-to-l hover:from-zinc-100 hover:to-transparent dark:hover:bg-zinc-800 rounded-lg flex gap-x-2 transition-colors"
               href={% url 'dashboard-favorites' %}>
                <svg class="text-zinc-600 dark:text-zinc-300" fill="currentColor" height="20" viewbox="0 0 256 256" width="20"
                     xmlns="http://www.w3.org/2000/svg">
                    <path d="M178,40c-20.65,0-38.73,8.88-50,23.89C116.73,48.88,98.65,40,78,40a62.07,62.07,0,0,0-62,62c0,70,103.79,126.66,108.21,129a8,8,0,0,0,7.58,0C136.21,228.66,240,172,240,102A62.07,62.07,0,0,0,178,40ZM128,214.8C109.74,204.16,32,155.69,32,102A46.06,46.06,0,0,1,78,56c19.45,0,35.78,10.36,42.6,27a8,8,0,0,0,14.8,0c6.82-16.67,23.15-27,42.6-27a46.06,46.06,0,0,1,46,46C224,155.61,146.24,204.15,128,214.8Z"></path>
                </svg>
                علاقه مندی ها
            </a>
        </li>
        <li>
            <a class="py-3 px-4 hover:bg-gradient-to-l hover:from-zinc-100 hover:to-transparent dark:hover:bg-zinc-800 rounded-lg flex gap-x-2 transition-colors"
               href="{% url 'dashboard-address' %}">
                <svg class="text-zinc-600 dark:text-zinc-300" fill="currentColor" height="20" viewbox="0 0 256 256" width="20"
                     xmlns="http://www.w3.org/2000/svg">
                    <path d="M112,80a16,16,0,1,1,16,16A16,16,0,0,1,112,80ZM64,80a64,64,0,0,1,128,0c0,59.95-57.58,93.54-60,94.95a8,8,0,0,1-7.94,0C121.58,173.54,64,140,64,80Zm16,0c0,42.2,35.84,70.21,48,78.5,12.15-8.28,48-36.3,48-78.5a48,48,0,0,0-96,0Zm122.77,67.63a8,8,0,0,0-5.54,15C213.74,168.74,224,176.92,224,184c0,13.36-36.52,32-96,32s-96-18.64-96-32c0-7.08,10.26-15.26,26.77-21.36a8,8,0,0,0-5.54-15C29.22,156.49,16,169.41,16,184c0,31.18,57.71,48,112,48s112-16.82,112-48C240,169.41,226.78,156.49,202.77,147.63Z"></path>
                </svg>
                آدرس ها
            </a>
        </li>
        <li>
            <a class="py-3 px-4 hover:bg-gradient-to-l hover:from-zinc-100 hover:to-transparent dark:hover:bg-zinc-800 rounded-lg flex gap-x-2 transition-colors"
               href={% url 'dashboard-details' %}>
                <svg class="text-zinc-600 dark:text-zinc-300" fill="currentColor" height="20" viewbox="0 0 256 256" width="20"
                     xmlns="http://www.w3.org/2000/svg">
                    <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path>
                </svg>
                اطلاعات شخصی
            </a>
        </li>
        <li>
            <a class="py-3 px-4 hover:bg-gradient-to-l hover:from-red-200 dark:hover:bg-red-900/40 text-red-500 hover:text-red-600 hover:to-transparent rounded-lg flex gap-x-2 group transition-colors"
               href={% url 'logout' %}>
                <svg class="text-zinc-600 dark:text-zinc-300 group-hover:text-red-600 transition" fill="currentColor" height="20"
                     viewbox="0 0 256 256" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M120,216a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V40a8,8,0,0,1,8-8h64a8,8,0,0,1,0,16H56V208h56A8,8,0,0,1,120,216Zm109.66-93.66-40-40a8,8,0,0,0-11.32,11.32L204.69,120H112a8,8,0,0,0,0,16h92.69l-26.35,26.34a8,8,0,0,0,11.32,11.32l40-40A8,8,0,0,0,229.66,122.34Z"></path>
                </svg>
                خروج
            </a>
        </li>
    </ul>
</div>
<div class="w-full lg:w-[83%] mr-auto flex flex-col min-h-screen bg-transparent">
    <!-- header -->
    <header class="bg-white dark:bg-zinc-900 w-full h-14 flex justify-between items-center px-4 shrink-0 transition-colors duration-300">
        <div class="flex gap-x-3 items-center">
            <!-- btn menu mobile -->
            <svg class="lg:hidden fill-zinc-800 menu-mobile" fill="" height="28" viewbox="0 0 256 256" width="28"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128ZM40,72H216a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16ZM216,184H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path>
            </svg>
            <div class="md:text-lg md:font-yekanBakhBold text-zinc-600 dark:text-zinc-100">
                صفحه اصلی
            </div>
        </div>
        <div class="flex items-center cursor-pointer group relative hover:bg-zinc-100 dark:hover:bg-zinc-800 transition px-4 py-2 rounded-lg">
<span class="flex items-center gap-x-1">
<span class="text-zinc-400 text-xs dark:text-zinc-400">
            سلام،
          </span>
<span class="text-zinc-600 text-sm dark:text-zinc-100">
            {{ request.user.fullname }}
          </span>
</span>
            <div class="z-50 group-hover:block left-0 top-[37px] w-60 rounded-lg bg-white dark:bg-zinc-900 drop-shadow-lg hidden absolute transition-colors">
                <ul class="space-y-1 p-2">
                    <li>
                        <a class="flex items-center justify-between gap-x-2 rounded-lg p-2 text-zinc-700 dark:text-zinc-200 hover:text-zinc-800 dark:hover:text-zinc-100 transition hover:bg-gray-100 dark:hover:bg-zinc-800"
                           href={% url 'dashboard-orders' %}>
<span class="flex items-center gap-x-2">
<svg class="text-zinc-500 dark:text-zinc-300" fill="currentColor" height="20" viewbox="0 0 256 256" width="20" xmlns="http://www.w3.org/2000/svg"><path
        d="M237.9,198.36l-14.25-120a14.06,14.06,0,0,0-14-12.36H174V64a46,46,0,0,0-92,0v2H46.33a14.06,14.06,0,0,0-14,12.36l-14.25,120a14,14,0,0,0,14,15.64H223.92a14,14,0,0,0,14-15.64ZM94,64a34,34,0,0,1,68,0v2H94ZM225.5,201.3a2.07,2.07,0,0,1-1.58.7H32.08a2.07,2.07,0,0,1-1.58-.7,1.92,1.92,0,0,1-.49-1.53l14.26-120A2,2,0,0,1,46.33,78H209.67a2,2,0,0,1,2.06,1.77l14.26,120A1.92,1.92,0,0,1,225.5,201.3Z"></path></svg>
<span class="text-sm">سفارش ها</span>
</span>
                        </a>
                    </li>
                    <li>
                        <a class="flex items-center justify-between gap-x-2 rounded-lg p-2 text-zinc-700 dark:text-zinc-200 hover:text-zinc-800 dark:hover:text-zinc-100 transition hover:bg-gray-100 dark:hover:bg-zinc-800"
                           href={% url 'dashboard-favorites' %}>
<span class="flex items-center gap-x-2">
<svg class="text-zinc-500 dark:text-zinc-300" fill="currentColor" height="20" viewbox="0 0 256 256" width="20" xmlns="http://www.w3.org/2000/svg"><path
        d="M178,34c-21,0-39.26,9.47-50,25.34C117.26,43.47,99,34,78,34A60.07,60.07,0,0,0,18,94c0,29.2,18.2,59.59,54.1,90.31a334.68,334.68,0,0,0,53.06,37,6,6,0,0,0,5.68,0,334.68,334.68,0,0,0,53.06-37C219.8,153.59,238,123.2,238,94A60.07,60.07,0,0,0,178,34ZM128,209.11C111.59,199.64,30,149.72,30,94A48.05,48.05,0,0,1,78,46c20.28,0,37.31,10.83,44.45,28.27a6,6,0,0,0,11.1,0C140.69,56.83,157.72,46,178,46a48.05,48.05,0,0,1,48,48C226,149.72,144.41,199.64,128,209.11Z"></path></svg>
<span class="text-sm">علاقه مندی ها</span>
</span>
                        </a>
                    </li>
                    <li>
                        <a class="flex items-center justify-between gap-x-2 rounded-lg p-2 text-zinc-700 dark:text-zinc-200 hover:text-zinc-800 dark:hover:text-zinc-100 transition hover:bg-gray-100 dark:hover:bg-zinc-800"
                           href="./profile-messages.html">
<span class="flex items-center gap-x-2">
<svg class="text-zinc-500 dark:text-zinc-300" fill="currentColor" height="20" viewbox="0 0 256 256" width="20" xmlns="http://www.w3.org/2000/svg"><path
        d="M227.33,91l-96-64a6,6,0,0,0-6.66,0l-96,64A6,6,0,0,0,26,96V200a14,14,0,0,0,14,14H216a14,14,0,0,0,14-14V96A6,6,0,0,0,227.33,91ZM100.18,152,38,195.9V107.65Zm12.27,6h31.1l62.29,44H50.16Zm43.37-6L218,107.65V195.9ZM128,39.21l85.43,57L143.53,146H112.47L42.57,96.17Z"></path></svg>
<span>پیغام ها</span>
</span>
                            <span class="relative flex h-5 w-5">
<span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-sky-500 opacity-75"></span>
<span class="relative inline-flex h-5 w-5 items-center justify-center rounded-full bg-sky-500 text-sm text-white">
                    4
                  </span>
</span>
                        </a>
                    </li>
                    <li>
                        <a class="flex items-center justify-between gap-x-2 rounded-lg p-2 text-red-500 hover:text-red-600 transition hover:bg-red-100 dark:hover:bg-red-900/40"
                           href="{% url 'logout' %}">
                            <div class="flex items-center gap-x-2">
<svg class="text-zinc-500 dark:text-zinc-300" fill="currentColor" height="20" viewbox="0 0 256 256" width="20"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path d="M110,216a6,6,0,0,1-6,6H48a14,14,0,0,1-14-14V48A14,14,0,0,1,48,34h56a6,6,0,0,1,0,12H48a2,2,0,0,0-2,2V208a2,2,0,0,0,2,2h56A6,6,0,0,1,110,216Zm110.24-92.24-40-40a6,6,0,0,0-8.48,8.48L201.51,122H104a6,6,0,0,0,0,12h97.51l-29.75,29.76a6,6,0,1,0,8.48,8.48l40-40A6,6,0,0,0,220.24,123.76Z"></path>
                                </svg>
                                <span>خروج از حساب کاربری</span>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </header>
    {% block content %}
    {% endblock %}
<footer class="bg-white dark:bg-zinc-900 h-12 flex items-center justify-end px-5 w-full text-zinc-500 dark:text-zinc-400 text-xs shrink-0 transition-colors duration-300">
        {% if footer_settings and footer_settings.copyright_text %}
            {{ footer_settings.copyright_text }}
        {% else %}
            ساخته شده توسط حامد سپهرنیا
        {% endif %}
    </footer>
    </div>
    </body>
    
    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 left-4 right-4 md:left-auto md:right-4 z-50 flex flex-col gap-2"></div>
    
    <style>
        .toast {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            min-width: 300px;
            max-width: 500px;
            animation: slideIn 0.3s ease-out;
            border-right: 4px solid #ef4444;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .toast.fade-out {
            animation: slideOut 0.3s ease-out forwards;
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        .product-fade-out {
            animation: fadeOut 0.3s ease-out forwards;
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: scale(1);
            }
            to {
                opacity: 0;
                transform: scale(0.95);
            }
        }
    </style>
    
    <script>
    // مدیریت دکمه‌های علاقه‌مندی در داشبورد
    document.addEventListener('DOMContentLoaded', function() {
        // مدیریت دکمه‌های علاقه‌مندی
        document.querySelectorAll('.toggle-favorite').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const productId = this.dataset.productId;
                if (!productId) return;
                
                toggleFavorite(productId, this);
            });
        });
        
        function toggleFavorite(productId, buttonElement) {
            // دریافت CSRF token
            const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                             document.cookie.match(/csrftoken=([^;]+)/)?.[1];
            
            fetch('/dashboard/favorites/toggle/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `product_id=${productId}`
            })
            .then(response => {
                if (response.status === 401) {
                    return { success: false, error: 'لطفا ابتدا وارد حساب کاربری خود شوید' };
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    // پیدا کردن آیکون مربوط به این دکمه
                    const icon = buttonElement.querySelector('.favorite-icon') || buttonElement.querySelector('svg');
                    const productCard = buttonElement.closest('.shiny, .card');
                    
                    if (icon) {
                        if (data.is_favorite) {
                            // آیکون سفید و background قرمز
                            icon.setAttribute('fill', '#ffffff');
                            Array.from(icon.classList).forEach(cls => {
                                if (cls.startsWith('fill-')) {
                                    icon.classList.remove(cls);
                                }
                            });
                            icon.classList.add('fill-white');
                            
                            if (icon.parentElement) {
                                icon.parentElement.classList.remove('bg-white');
                                icon.parentElement.classList.add('bg-red-500');
                            }
                        } else {
                            // آیکون مشکی و background سفید
                            icon.setAttribute('fill', '#111111');
                            Array.from(icon.classList).forEach(cls => {
                                if (cls.startsWith('fill-')) {
                                    icon.classList.remove(cls);
                                }
                            });
                            icon.classList.add('fill-zinc-700');
                            
                            if (icon.parentElement) {
                                icon.parentElement.classList.remove('bg-red-500');
                                icon.parentElement.classList.add('bg-white');
                            }
                            
                            // اگر در صفحه علاقه‌مندی‌ها هستیم، محصول را حذف کن
                            if (window.location.pathname.includes('favorites') && productCard) {
                                // نمایش toast با قابلیت undo
                                showUndoToast(productId, productCard, buttonElement);
                            }
                        }
                    }
                } else {
                    alert(data.error || 'خطا در به‌روزرسانی علاقه‌مندی');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('خطا در ارتباط با سرور');
            });
        }
        
        function showUndoToast(productId, productCard, buttonElement) {
            // ذخیره اطلاعات برای undo
            const productData = {
                id: productId,
                card: productCard,
                button: buttonElement,
                html: productCard.outerHTML
            };
            
            // حذف موقت از صفحه (fade out)
            productCard.classList.add('product-fade-out');
            
            setTimeout(() => {
                productCard.style.display = 'none';
            }, 300);
            
            // ایجاد toast
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <div class="flex items-center gap-2 flex-1">
                    <svg class="fill-red-500 shrink-0" fill="#ef4444" height="20" viewbox="0 0 256 256" width="20" xmlns="http://www.w3.org/2000/svg">
                        <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm37.66-61.66a8,8,0,0,1,0,11.32l-32,32a8,8,0,0,1-11.32,0l-16-16a8,8,0,0,1,11.32-11.32L128,172.69l26.34-26.35A8,8,0,0,1,165.66,154.34Z"></path>
                    </svg>
                    <span class="text-sm text-zinc-700">محصول از علاقه‌مندی‌ها حذف شد</span>
                </div>
                <button class="text-sm text-primary-500 hover:text-primary-600 font-semibold undo-btn shrink-0 px-2 py-1 rounded hover:bg-primary-50 transition-colors" data-product-id="${productId}">
                    واگرد
                </button>
            `;
            
            const container = document.getElementById('toast-container');
            container.appendChild(toast);
            
            // ذخیره داده برای undo
            toast.dataset.productId = productId;
            window.lastRemovedProduct = productData;
            
            // مدیریت دکمه undo
            const undoBtn = toast.querySelector('.undo-btn');
            undoBtn.addEventListener('click', function() {
                undoRemove(productId, productCard, buttonElement, toast);
            });
            
            // حذف خودکار بعد از 5 ثانیه
            const timeout = setTimeout(() => {
                removeToast(toast);
                // اگر undo نشد، حذف کامل از DOM
                if (productCard.parentElement && productCard.style.display === 'none') {
                    productCard.remove();
                }
            }, 5000);
            
            // ذخیره timeout برای لغو در صورت undo
            toast.dataset.timeout = timeout;
        }
        
        function undoRemove(productId, productCard, buttonElement, toast) {
            // لغو timeout
            if (toast.dataset.timeout) {
                clearTimeout(toast.dataset.timeout);
            }
            
            // حذف toast
            removeToast(toast);
            
            // بازگرداندن محصول به صفحه
            productCard.style.display = '';
            productCard.classList.remove('product-fade-out');
            
            // بازگرداندن به علاقه‌مندی‌ها از طریق API
            const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                             document.cookie.match(/csrftoken=([^;]+)/)?.[1];
            
            fetch('/dashboard/favorites/toggle/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `product_id=${productId}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.is_favorite) {
                    // به‌روزرسانی آیکون
                    const icon = buttonElement.querySelector('.favorite-icon') || buttonElement.querySelector('svg');
                    if (icon) {
                        icon.setAttribute('fill', '#ffffff');
                        Array.from(icon.classList).forEach(cls => {
                            if (cls.startsWith('fill-')) {
                                icon.classList.remove(cls);
                            }
                        });
                        icon.classList.add('fill-white');
                        
                        if (icon.parentElement) {
                            icon.parentElement.classList.remove('bg-white');
                            icon.parentElement.classList.add('bg-red-500');
                        }
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
        
        function removeToast(toast) {
            toast.classList.add('fade-out');
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 300);
        }
    });
    </script>
    
    <script src='{% static "./assets/js/swiper.min.js" %}'></script>
    <script src='{% static "./assets/js/sliders.js" %}'></script>
    <script src='{% static "./assets/js/main.js" %}'></script>
    </html>