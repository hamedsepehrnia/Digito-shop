{% extends 'accounts/dashboard_base.html' %}
{% load static %}
{% load humanize %}
{% block content %}
    <main class="p-6 flex-1 overflow-y-auto">
        <div class="bg-white dark:bg-zinc-900 rounded-2xl min-h-80 h-auto shadow-custom p-4 transition-colors duration-300">
            <div class="px-2 md:px-3 pt-3 pb-5 mb-3 text-zinc-700 dark:text-zinc-200 text-sm md:text-base flex items-center gap-x-2 border-b border-zinc-200 dark:border-zinc-700">
                <svg class="fill-primary-500" fill="currentColor" height="20" viewbox="0 0 256 256" width="20"
                     xmlns="http://www.w3.org/2000/svg">
                    <path d="M128,16a88.1,88.1,0,0,0-88,88c0,75.3,80,132.17,83.41,134.55a8,8,0,0,0,9.18,0C136,236.17,216,179.3,216,104A88.1,88.1,0,0,0,128,16Zm0,56a32,32,0,1,1-32,32A32,32,0,0,1,128,72Z"></path>
                </svg>
                جزئیات سفارش #{{ order.order_number }}
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3 xl:gap-4">
                {% for item in order_items %}
                <div class="shiny my-2 p-2 md:p-4 hover:border-transparent hover:shadow-lg transition-shadow rounded-3xl border border-zinc-200 dark:border-zinc-700 dark:bg-zinc-900">
                    <a class="image-box mb-6 block py-10" href="{% if item.product %}{% url 'product' item.product.slug %}{% else %}#{% endif %}">
                        {% if item.product and item.product.images.first %}
                        <img alt="{% if item.product %}{{ item.product.title }}{% endif %}" class="max-w-40 mx-auto" src="{{ item.product.images.first.image.url }}">
                        {% else %}
                        <img alt="تصویر محصول" class="max-w-40 mx-auto bg-gray-100 dark:bg-zinc-800" src='{% static "./assets/image/placeholder.svg" %}'>
                        {% endif %}
                    </a>
                    <a class="text-sm font-semibold text-zinc-700 dark:text-zinc-200 h-10 line-clamp-2" href="{% if item.product %}{% url 'product' item.product.slug %}{% else %}#{% endif %}">
                        {% if item.product %}
                        {{ item.product.title }}
                        {% else %}
                        محصول حذف شده
                        {% endif %}
                    </a>
                    <div class="flex my-5">
                        <div class="text-xl md:text-2xl text-zinc-800 dark:text-zinc-100">{{ item.get_total_price|intcomma }}</div>
                        <div class="-rotate-90 text-zinc-400 text-xs dark:text-zinc-500">
                            تومان
                        </div>
                    </div>
                    {% if item.quantity > 1 %}
                    <div class="text-xs text-zinc-500 dark:text-zinc-400 text-center">
                        تعداد: {{ item.quantity }} عدد
                    </div>
                    {% endif %}
                </div>
                {% empty %}
                <div class="col-span-full text-center text-zinc-500 dark:text-zinc-400 py-8">
                    آیتمی در این سفارش وجود ندارد
                </div>
                {% endfor %}
            </div>
            <div class="px-2 sm:px-6 py-3 rounded-xl border border-zinc-300 dark:border-zinc-700 mx-auto my-5 max-w-md">
                <div class="flex gap-x-1 justify-center items-center text-zinc-700">
                    <svg class="fill-zinc-500" fill="currentColor" height="20" viewbox="0 0 256 256" width="20"
                         xmlns="http://www.w3.org/2000/svg">
                        <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm-4,48a12,12,0,1,1-12,12A12,12,0,0,1,124,72Zm12,112a16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40a8,8,0,0,1,0,16Z"></path>
                    </svg>
                    اطلاعات پرداخت
                </div>
                <div class="flex gap-x-1 justify-between items-center text-zinc-600 mt-5 bg-gray-100 dark:bg-zinc-800 rounded-lg px-2 py-3 text-sm">
                    <div>
                        قیمت کالاها ({{ order_items|length }})
                    </div>
                    <div class="flex gap-x-1">
                        <div>
                            {{ order.total_price|intcomma }}
                        </div>
                        <div>
                            تومان
                        </div>
                    </div>
                </div>
                {% if order.shipping_cost > 0 %}
                <div class="flex gap-x-1 justify-between items-center text-zinc-600 mt-3 bg-gray-100 dark:bg-zinc-800 rounded-lg px-2 py-3 text-sm">
                    <div>
                        هزینه ارسال
                    </div>
                    <div class="flex gap-x-1">
                        <div>
                            {{ order.shipping_cost|intcomma }}
                        </div>
                        <div>
                            تومان
                        </div>
                    </div>
                </div>
                {% endif %}
                <div class="flex gap-x-1 justify-between items-center text-zinc-600 mt-3 bg-gray-100 dark:bg-zinc-800 rounded-lg px-2 py-3 text-sm">
                    <div>
                        تاریخ
                    </div>
                    <div class="flex gap-x-1">
                        <div>
                            {{ order.jalali_created }}
                        </div>
                    </div>
                </div>
                <div class="flex gap-x-1 justify-between items-center text-zinc-600 mt-3 bg-gray-100 dark:bg-zinc-800 rounded-lg px-2 py-3 text-sm">
                    <div>
                        شماره پیگیری
                    </div>
                    <div class="flex gap-x-1">
                        <div>
                            #{{ order.order_number }}
                        </div>
                    </div>
                </div>
                <div class="flex gap-x-1 justify-between items-center text-zinc-800 mt-3 bg-gray-100 dark:bg-zinc-800 rounded-lg px-2 py-3 text-sm">
                    <div>
                        جمع سبد خرید
                    </div>
                    <div class="flex gap-x-1">
                        <div>
                            {{ order.get_final_price|intcomma }}
                        </div>
                        <div>
                            تومان
                        </div>
                    </div>
                </div>
                {% if order.address %}
                <div class="flex gap-x-1 justify-between items-center text-zinc-800 mt-3 bg-gray-100 dark:bg-zinc-800 rounded-lg px-2 py-3 text-sm">
                    <div>
                        آدرس
                    </div>
                    <div class="text-right text-xs">
                        {{ order.address.province }} - {{ order.address.city }} - {{ order.address.address_details }}
                    </div>
                </div>
                {% endif %}
                <button onclick="window.print()" class="block text-center w-full px-2 py-3 mt-5 text-sm bg-gradient-to-bl from-primary-500 to-primary-700 hover:opacity-80 transition text-gray-100 rounded-lg cursor-pointer">
                    چاپ
                </button>
            </div>
        </div>
    </main>
    
    <style>
        @media print {
            /* مخفی کردن منو و بخش‌های غیرضروری هنگام چاپ */
            .dashboard-sidebar,
            header,
            footer,
            .menu-mobile,
            button[onclick="window.print()"] {
                display: none !important;
            }
            
            /* تنظیمات صفحه برای چاپ */
            body {
                background: white !important;
            }
            
            .bg-white {
                box-shadow: none !important;
                border: none !important;
            }
            
            /* بهبود نمایش در چاپ */
            .shiny {
                border: 1px solid #e5e7eb !important;
                page-break-inside: avoid;
            }
        }
    </style>
    
    {% endblock %}