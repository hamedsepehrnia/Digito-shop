{% extends 'core/base.html' %}
{% load static %}
{% block content %}
    <main class="mt-0 md:mt-8">
        <div class="px-4 md:px-8 md:mt-10 pb-20">
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- photo -->
                <div class="lg:w-4/12">
                    <div class="flex gap-x-5 pr-10">
                        {% if user.is_authenticated %}
                        <a class="relative toggle-favorite" href="#" data-product-id="{{ product.id }}">
                            <div class="group cursor-pointer relative inline-block text-center">
                                <svg class="{% if is_favorite %}bg-red-500 fill-white{% else %}bg-white fill-zinc-700{% endif %} hover:fill-red-400 transition favorite-icon rounded-full p-2" fill="{% if is_favorite %}#ffffff{% else %}#000000{% endif %}" height="26"
                                     viewbox="0 0 256 256" width="26" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M178,32c-20.65,0-38.73,8.88-50,23.89C116.73,40.88,98.65,32,78,32A62.07,62.07,0,0,0,16,94c0,70,103.79,126.66,108.21,129a8,8,0,0,0,7.58,0C136.21,220.66,240,164,240,94A62.07,62.07,0,0,0,178,32ZM128,206.8C109.74,196.16,32,147.69,32,94A46.06,46.06,0,0,1,78,48c19.45,0,35.78,10.36,42.6,27a8,8,0,0,0,14.8,0c6.82-16.67,23.15-27,42.6-27a46.06,46.06,0,0,1,46,46C224,147.61,146.24,196.15,128,206.8Z"></path>
                                </svg>
                                <div class="opacity-0 w-28 transition-all bg-zinc-800 text-white text-center text-xs rounded-lg py-2 absolute z-10 -left-11 group-hover:opacity-100 px-3 pointer-events-none">
                                    <span class="favorite-text">{% if is_favorite %}حذف از علاقه‌مندی‌ها{% else %}افزودن به علاقه‌مندی‌ها{% endif %}</span>
                                    <svg class="absolute text-black h-2 w-full left-0 bottom-full rotate-180"
                                         viewbox="0 0 255 255" x="0px" xml:space="preserve" y="0px"><polygon class="fill-current" points="0,0,127.5,127.5,255,0"></polygon></svg>
                                </div>
                            </div>
                        </a>
                        {% endif %}
                        <a class="relative" href="#" onclick="copyToClipboard(event)">
                            <div class="group cursor-pointer relative inline-block text-center">
                                <svg class="fill-zinc-700 hover:fill-zinc-800 transition" height="26"
                                     viewbox="0 0 256 256" width="26" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M176,160a39.89,39.89,0,0,0-28.62,12.09l-46.1-29.63a39.8,39.8,0,0,0,0-28.92l46.1-29.63a40,40,0,1,0-8.66-13.45l-46.1,29.63a40,40,0,1,0,0,55.82l46.1,29.63A40,40,0,1,0,176,160Zm0-128a24,24,0,1,1-24,24A24,24,0,0,1,176,32ZM64,152a24,24,0,1,1,24-24A24,24,0,0,1,64,152Zm112,72a24,24,0,1,1,24-24A24,24,0,0,1,176,224Z"></path>
                                </svg>
                                <div class="opacity-0 w-28 transition-all bg-zinc-800 text-white text-center text-xs rounded-lg py-2 absolute z-10 -left-11 group-hover:opacity-100 px-3 pointer-events-none">
                                    اشتراک گذاری
                                    <svg class="absolute text-black h-2 w-full left-0 bottom-full rotate-180"
                                         viewbox="0 0 255 255" x="0px" y="0px">
                                        <polygon class="fill-current" points="0,0 127.5,127.5 255,0"></polygon>
                                    </svg>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="relative">
                        <div class="flex gap-4 justify-center">
                            <div class="hidden absolute -left-56 top-0 md:size-64 bg-no-repeat bg-cover border-2 border-gray-300 rounded-md bg-white"
                                 id="zoomBox"></div>
                            <div class="relative overflow-hidden group">
                                {% if product.images.first %}
                                <img alt="عکس محصول" class="w-full max-w-96 object-cover rounded-lg" id="mainImage"
                                     src='{{ product.images.first.image.url }}'/>
                                {% else %}
                                <img alt="عکس محصول" class="w-full max-w-96 object-cover rounded-lg" id="mainImage"
                                     src='{% static "./assets/image/products/2.webp" %}'/>
                                {% endif %}
                                <div class="hidden absolute w-20 h-20 bg-gray-300 opacity-30 pointer-events-none"
                                     id="zoomLens"></div>
                            </div>
                        </div>
                        <div class="flex justify-start gap-2 mt-4 overflow-x-auto">
                            {% for img in product.images.all %}
                                <img class="w-20 h-20 object-cover rounded-md cursor-pointer border border-zinc-200 hover:border-zinc-400 opacity-80 hover:opacity-100 transition-all"
                                     onclick="changeImage(this)" src='{{ img.image.url }}'/>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <!-- info -->
                <div class="lg:w-5/12">
                    <div class="mb-7 text-xs flex flex-wrap space-y-2 md:space-y-0 items-center gap-x-2 opacity-90">
                        <a class="text-zinc-500 hover:text-primary-500 transition" href="{% url 'shop' %}">
                            فروشگاه
                        </a>
                        {% if product.category %}
                        <svg class="size-3 fill-zinc-500" fill="#3d3d3d" height="16" viewbox="0 0 256 256" width="16"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
                        </svg>
                        <a class="text-zinc-500 hover:text-primary-500 transition" href="{% url 'shop' %}?category={{ product.category.slug }}">
                            {{ product.category.name }}
                        </a>
                        {% endif %}
                        <svg class="size-3 fill-zinc-500" fill="#3d3d3d" height="16" viewbox="0 0 256 256" width="16"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
                        </svg>
                        <a class="text-primary-500" href="#">
                            {{ product.title }}
                        </a>
                    </div>
                    <div class="text-zinc-800 md:text-2xl font-semibold leading-7">
                        {{ product.title }}
                    </div>
                    <div class="text-zinc-400 text-xs md:text-sm mt-4">
                        {{ product.english_title }}
                    </div>
                    <a class="flex items-start gap-x-1 text-sm text-primary-500 mt-3" href="">
                        <svg class="fill-primary-400" fill="" height="16" viewbox="0 0 256 256" width="16"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M140,128a12,12,0,1,1-12-12A12,12,0,0,1,140,128ZM84,116a12,12,0,1,0,12,12A12,12,0,0,0,84,116Zm88,0a12,12,0,1,0,12,12A12,12,0,0,0,172,116Zm60,12A104,104,0,0,1,79.12,219.82L45.07,231.17a16,16,0,0,1-20.24-20.24l11.35-34.05A104,104,0,1,1,232,128Zm-16,0A88,88,0,1,0,51.81,172.06a8,8,0,0,1,.66,6.54L40,216,77.4,203.53a7.85,7.85,0,0,1,2.53-.42,8,8,0,0,1,4,1.08A88,88,0,0,0,216,128Z"></path>
                        </svg>
                        <span>
<span>
                {{ product.comments.count }}
              </span>
<span>
                دیدگاه
              </span>
</span>
                    </a>
                    <div class="mt-8 text-zinc-700">
                        ویژگی های محصول:
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-3 max-w-md py-3 mb-5 gap-3">
                        {% for spec in product.specs.all %}
                            <div class="flex flex-col gap-x-2 justify-center bg-gray-100 rounded-md px-2 py-3">
                                <div class="text-zinc-500 text-xs">
                                    {{ spec.key }}:
                                </div>
                                <div class="text-zinc-700 text-sm">
                                    {{ spec.value }}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="flex gap-x-2 mt-2 pt-2 text-zinc-500 text-xs md:text-sm border-t border-t-zinc-200 leading-6">
                        <svg class="fill-zinc-500" fill="" height="24" viewbox="0 0 256 256" width="24"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path>
                        </svg>
                        درخواست مرجوع کردن کالا در گروه لپ تاپ با دلیل "انصراف از خرید" تنها در صورتی قابل تایید است که
                        کالا در شرایط اولیه باشد (در صورت پلمپ بودن، کالا نباید باز شده باشد).
                    </div>
                </div>
                <!-- buy -->
                <div class="lg:w-3/12">
                    <div class="lg:mt-8 mb-8">
                        <div class="text-zinc-700">
                            رنگ:
                        </div>
                        <ul class="flex flex-wrap gap-2">
                            {% for color in colors %}
                                <li>
                                    <input class="hidden peer" id="color_{{ color.id }}" name="color" type="radio" value="{{ color.id }}"/>
                                    <label class="inline-flex items-center justify-center px-2 py-3 text-gray-600 bg-white border-2 border-gray-200 rounded-full cursor-pointer peer-checked:border-primary-300 hover:text-gray-600 hover:bg-gray-100"
                                           for="color_{{ color.id }}"
                                           style="color: {{ color.hex_code }}; border-color: {{ color.hex_code }};">
                                        <div class="flex gap-x-2">
                                            <div class="w-5 h-5 rounded-full" style="background-color: {{ color.hex_code }};"></div>
                                            <div class="text-sm">{{ color.name }}</div>
                                        </div>
                                    </label>
                                </li>
                            {% empty %}
                                <li class="text-zinc-500 text-sm">رنگی برای این محصول تعریف نشده است.</li>
                            {% endfor %}
                    </ul>
                </div>
                <div class="p-3 border border-zinc-300 rounded-xl mx-auto divide-y divide-zinc-200">
                    <div class="flex gap-x-1 items-center text-zinc-600 text-sm pb-5 pt-3">
                        <svg class="fill-zinc-700" fill="" height="20" viewbox="0 0 256 256" width="20"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M208,40H48A16,16,0,0,0,32,56v58.78c0,89.61,75.82,119.34,91,124.39a15.53,15.53,0,0,0,10,0c15.2-5.05,91-34.78,91-124.39V56A16,16,0,0,0,208,40Zm0,74.79c0,78.42-66.35,104.62-80,109.18-13.53-4.51-80-30.69-80-109.18V56H208ZM82.34,141.66a8,8,0,0,1,11.32-11.32L112,148.68l50.34-50.34a8,8,0,0,1,11.32,11.32l-56,56a8,8,0,0,1-11.32,0Z"></path>
                        </svg>
                        <div>
                            گارانتی {{ product.warranty_months }} ماهه
                        </div>
                    </div>
                    <div class="flex gap-x-1 items-center text-zinc-600 text-sm py-5">
                        <svg class="fill-zinc-700" fill="" height="20" viewbox="0 0 256 256" width="20"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M247.42,117l-14-35A15.93,15.93,0,0,0,218.58,72H184V64a8,8,0,0,0-8-8H24A16,16,0,0,0,8,72V184a16,16,0,0,0,16,16H41a32,32,0,0,0,62,0h50a32,32,0,0,0,62,0h17a16,16,0,0,0,16-16V120A7.94,7.94,0,0,0,247.42,117ZM184,88h34.58l9.6,24H184ZM24,72H168v64H24ZM72,208a16,16,0,1,1,16-16A16,16,0,0,1,72,208Zm81-24H103a32,32,0,0,0-62,0H24V152H168v12.31A32.11,32.11,0,0,0,153,184Zm31,24a16,16,0,1,1,16-16A16,16,0,0,1,184,208Zm48-24H215a32.06,32.06,0,0,0-31-24V128h48Z"></path>
                        </svg>
                        <div>
                            ارسال {{ product.delivery_date }} روز کاری
                        </div>
                    </div>
                    <div class="flex gap-x-1 items-center text-green-500 text-sm py-5">
                        <svg class="fill-green-500" fill="" height="20" viewbox="0 0 256 256" width="20"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M234,80.12A24,24,0,0,0,216,72H160V56a40,40,0,0,0-40-40,8,8,0,0,0-7.16,4.42L75.06,96H32a16,16,0,0,0-16,16v88a16,16,0,0,0,16,16H204a24,24,0,0,0,23.82-21l12-96A24,24,0,0,0,234,80.12ZM32,112H72v88H32ZM223.94,97l-12,96a8,8,0,0,1-7.94,7H88V105.89l36.71-73.43A24,24,0,0,1,144,56V80a8,8,0,0,0,8,8h64a8,8,0,0,1,7.94,9Z"></path>
                        </svg>
                        <div>
                            رضایت از محصول:
                        </div>
                        <span>
                {{ product.satisfaction_percent }}
              </span>
                    </div>
                    <div class="flex flex-col justify-center py-5">
                        <div class="text-zinc-800 text-left">
                            <span class="font-yekanBakhExtraBold text-3xl">{{ product.price }}</span>
                            <span class="text-xs">تومان</span>
                        </div>
                        {% if product.stock < 10 %}
                            <div class="text-xs text-red-400">
                                تنها {{ product.stock }} عدد در انبار باقی مانده
                            </div>
                        {% endif %}
                        <div class="quantity-container mt-5 flex h-10 w-full items-center justify-between rounded-lg border border-gray-100 px-2 py-1">
                            <button class="cursor-pointer" data-action="increment" type="button">
                                <svg class="fill-green-500 size-5" height="18" viewbox="0 0 256 256" width="18"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path d="M222,128a6,6,0,0,1-6,6H134v82a6,6,0,0,1-12,0V134H40a6,6,0,0,1,0-12h82V40a6,6,0,0,1,12,0v82h82A6,6,0,0,1,222,128Z"></path>
                                </svg>
                            </button>
                            <input class="flex h-5 w-full grow select-none items-center justify-center bg-transparent text-center text-sm md:text-lg font-yekanBakhExtraBold text-zinc-600 outline-none"
                                   disabled="" type="number" value="1"/>
                            <button class="cursor-pointer" data-action="decrement" type="button">
                                <svg class="fill-red-500 size-5" height="18" viewbox="0 0 256 256" width="18"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path d="M222,128a6,6,0,0,1-6,6H40a6,6,0,0,1,0-12H216A6,6,0,0,1,222,128Z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    {% if product.stock > 0 %}
                    <button class="hidden lg:block mx-auto cursor-pointer w-full px-2 py-3 text-sm bg-gradient-to-bl from-primary-500 to-primary-400 hover:opacity-90 transition text-gray-100 rounded-lg add-to-cart-btn" data-product-id="{{ product.id }}">
                        افزودن به سبد خرید
                    </button>
                    {% else %}
                    <button class="hidden lg:block mx-auto w-full px-2 py-3 text-sm bg-gradient-to-bl from-primary-500 to-primary-400 opacity-80 cursor-not-allowed transition text-gray-100 rounded-lg">
                        محصول موجود نیست!
                    </button>
                    {% endif %}
                </div>
                <!-- fixed div buy mobile -->
                <div class="fixed flex bottom-0 right-0 lg:hidden bg-white border-t border-t-zinc-300 w-full px-5 py-3 gap-x-2 z-50">
                    {% if product.stock > 0 %}
                    <button class="mx-auto 5 w-1/2 px-2 py-3 text-sm bg-gradient-to-bl from-primary-500 to-primary-400 hover:opacity-90 transition text-gray-100 rounded-lg add-to-cart-btn" data-product-id="{{ product.id }}">
                        افزودن به سبد خرید
                    </button>
                    {% else %}
                    <button class="mx-auto 5 w-1/2 px-2 py-3 text-sm bg-gradient-to-bl from-primary-500 to-primary-400 opacity-80 cursor-not-allowed transition text-gray-100 rounded-lg">
                        محصول موجود نیست!
                    </button>
                    {% endif %}
                    <span class="flex flex-col justify-center items-end w-1/2">
<div class="text-zinc-700 text-left">
<span class="font-yekanBakhExtraBold text-2xl">{{ product.price }}</span>
<span class="text-xs">تومان</span>
</div>
                        {% if product.stock < 10 %}
                            <div class="text-xs text-red-400">
                تنها {{ product.stock }} عدد در انبار باقی مانده
              </div>
                        {% endif %}
</span>
                </div>
            </div>
        </div>
        <div class="flex gap-x-8 mt-20 pb-2 border-b border-zinc-200">
            <a class="text-zinc-600 hover:text-zinc-800 transition" href="#details">
                توضیحات
            </a>
            <a class="text-zinc-600 hover:text-zinc-800 transition" href="#proper">
                مشخصات
            </a>
            <a class="text-zinc-600 hover:text-zinc-800 transition" href="#comments">
                دیدگاه ها
            </a>
        </div>
        <div class="p-4 border-b border-zinc-200" id="details">
            <p class="text-zinc-800 md:text-lg mb-1 mt-4">
                توضیحات این محصول
            </p>
            <div class="text-zinc-700 text-sm md:text-base leading-7">
                {{ product.description|linebreaks }}
            </div>
        </div>
        <div class="p-4 border-b border-zinc-200" id="proper">
            <p class="text-zinc-800 md:text-lg mb-1 mt-4">
                مشخصات محصول
            </p>
            <div class="text-gray-500 text-sm divide-y divide-zinc-200">
                {% for spect in product.specs.all %}
                <div class="flex items-center justify-start p-3 pb-6 w-full my-4">
                    <div class="text-sm md:text-basetext-zinc-700 w-3/12 font-yekanBakhRegular">
                        {{ spect.key }}:
                    </div>
                    <div class="md:text-lg text-zinc-600 w-9/12 font-yekanBakhExtraBold">
                        {{ spect.value }}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="p-4" id="comments">
            <p class="text-zinc-800 md:text-lg mb-1 mt-4">
                دیدگاه ها
            </p>
            <div class="lg:flex gap-5">
                <div class="lg:w-3/12 py-5">
                    {% if user.is_authenticated %}
                    <form method="post" action="{% url 'add_comment' product.slug %}">
                        {% csrf_token %}
                    <div class="mt-4 mb-2 text-sm text-zinc-700">
                        شما هم دیدگاه خود را ثبت کنید
                    </div>
                    <ul class="grid my-3 gap-5 grid-cols-2">
                        <li>
                            <input class="hidden peer" id="yes" name="recommendation" type="checkbox" value="True"/>
                            <label class="inline-flex items-center justify-center w-full px-2 py-3 text-gray-600 bg-white border border-gray-200 rounded-lg cursor-pointer peer-checked:border-green-400 peer-checked:text-green-500 hover:text-gray-600 hover:bg-gray-100"
                                   for="yes">
                                <div class="flex items-center gap-x-1">
                                    <svg class="fill-green-500" fill="" height="22" viewbox="0 0 256 256" width="22"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M234,80.12A24,24,0,0,0,216,72H160V56a40,40,0,0,0-40-40,8,8,0,0,0-7.16,4.42L75.06,96H32a16,16,0,0,0-16,16v88a16,16,0,0,0,16,16H204a24,24,0,0,0,23.82-21l12-96A24,24,0,0,0,234,80.12ZM32,112H72v88H32ZM223.94,97l-12,96a8,8,0,0,1-7.94,7H88V105.89l36.71-73.43A24,24,0,0,1,144,56V80a8,8,0,0,0,8,8h64a8,8,0,0,1,7.94,9Z"></path>
                                    </svg>
                                    <div class="text-sm">پیشنهاد میشود</div>
                                </div>
                            </label>
                        </li>
                        <li>
                            <input class="hidden peer" id="bought" name="bought_by_author" type="checkbox" value="True"/>
                            <label class="inline-flex items-center justify-center w-full px-2 py-3 text-gray-600 bg-white border border-gray-200 rounded-lg cursor-pointer peer-checked:border-blue-400 peer-checked:text-blue-500 hover:text-gray-600 hover:bg-gray-100"
                                   for="bought">
                                <div class="flex items-center gap-x-1">
                                    <svg class="fill-blue-500" fill="" height="22" viewbox="0 0 256 256" width="22"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M239.82,157l-12-96A24,24,0,0,0,204,40H32A16,16,0,0,0,16,56v88a16,16,0,0,0,16,16H75.06l37.78,75.58A8,8,0,0,0,120,240a40,40,0,0,0,40-40V184h56a24,24,0,0,0,23.82-27ZM72,144H32V56H72Zm150,21.29a7.88,7.88,0,0,1-6,2.71H152a8,8,0,0,0-8,8v24a24,24,0,0,1-19.29,23.54L88,150.11V56H204a8,8,0,0,1,7.94,7l12,96A7.87,7.87,0,0,1,222,165.29Z"></path>
                                    </svg>
                                    <div class="text-sm">خریداری کرده‌ام</div>
                                </div>
                            </label>
                        </li>
                    </ul>
                    {{ comment_form.content }}
                    <button class="hidden lg:block mx-auto cursor-pointer w-full px-2 py-3 text-sm bg-gradient-to-bl from-primary-500 to-primary-400 hover:opacity-90 transition text-gray-100 rounded-lg"
                    type="submit">
                        ارسال دیدگاه
                    </button>
                        </form>
                    {% else %}
                    <div class="text-center text-zinc-600 py-10">
                        <p>برای ثبت نظر باید وارد شوید</p>
                        <a href="{% url 'dashboard-details' %}" class="text-primary-500 mt-2 inline-block">ورود / ثبت نام</a>
                    </div>
                    {% endif %}
                </div>
                <div class="lg:w-9/12 divide-y-2 divide-zinc-300">
                    {% for comment in product.comments.all %}
                    <div class="px-2 pt-5">
                        <div class="mt-2 flex gap-x-4 items-center border-b border-zinc-200 pb-3">
                            <div class="text-xs text-zinc-600">
                                {{ comment.jalali_created }}
                            </div>
                            <div class="text-xs text-zinc-600">
                                {{ comment.author.fullname|default:comment.author.phone }}
                            </div>
                            {% if comment.bought_by_author %}
                            <div class="text-xs text-zinc-50 bg-green-400 rounded-full px-2 py-1">
                                خریدار
                            </div>
                            {% endif %}
                        </div>
                        <div class="flex items-center gap-x-1 pt-3">
                            <svg class="fill-green-500" fill="" height="22" viewbox="0 0 256 256" width="22"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M234,80.12A24,24,0,0,0,216,72H160V56a40,40,0,0,0-40-40,8,8,0,0,0-7.16,4.42L75.06,96H32a16,16,0,0,0-16,16v88a16,16,0,0,0,16,16H204a24,24,0,0,0,23.82-21l12-96A24,24,0,0,0,234,80.12ZM32,112H72v88H32ZM223.94,97l-12,96a8,8,0,0,1-7.94,7H88V105.89l36.71-73.43A24,24,0,0,1,144,56V80a8,8,0,0,0,8,8h64a8,8,0,0,1,7.94,9Z"></path>
                            </svg>
                            {% if comment.recommendation %}
                            <div class="text-sm text-green-500">پیشنهاد میشود</div>
                            {% else %}
                            <div class="text-sm text-red-500">پیشنهاد نمیشود</div>
                            {% endif %}
                        </div>
                        <div class="mt-2 text-zinc-600 text-sm">
                            {{ comment.content }}
                        </div>
                        <div class="flex justify-end items-center gap-x-5 mt-3">
                            <div class="text-sm text-zinc-400">
                                آیا این دیدگاه برایتان مفید بود؟
                            </div>
                            <ul class="grid my-3 gap-5 grid-cols-2">
                                <li>
                                    <input class="hidden peer" id="isgood" name="what" required="" type="radio"
                                           value="isgood"/>
                                    <label class="inline-flex p-2 border border-gray-200 rounded-lg cursor-pointer peer-checked:border-green-400 hover:bg-gray-100"
                                           for="isgood">
                                        <svg class="fill-green-500" fill="" height="22" viewbox="0 0 256 256"
                                             width="22" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M234,80.12A24,24,0,0,0,216,72H160V56a40,40,0,0,0-40-40,8,8,0,0,0-7.16,4.42L75.06,96H32a16,16,0,0,0-16,16v88a16,16,0,0,0,16,16H204a24,24,0,0,0,23.82-21l12-96A24,24,0,0,0,234,80.12ZM32,112H72v88H32ZM223.94,97l-12,96a8,8,0,0,1-7.94,7H88V105.89l36.71-73.43A24,24,0,0,1,144,56V80a8,8,0,0,0,8,8h64a8,8,0,0,1,7.94,9Z"></path>
                                        </svg>
                                    </label>
                                </li>
                                <li>
                                    <input class="hidden peer" id="isbad" name="what" required="" type="radio"
                                           value="isbad"/>
                                    <label class="inline-flex p-2 border border-gray-200 rounded-lg cursor-pointer peer-checked:border-red-400 hover:bg-gray-100"
                                           for="isbad">
                                        <svg class="fill-red-500" fill="" height="22" viewbox="0 0 256 256"
                                             width="22" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M239.82,157l-12-96A24,24,0,0,0,204,40H32A16,16,0,0,0,16,56v88a16,16,0,0,0,16,16H75.06l37.78,75.58A8,8,0,0,0,120,240a40,40,0,0,0,40-40V184h56a24,24,0,0,0,23.82-27ZM72,144H32V56H72Zm150,21.29a7.88,7.88,0,0,1-6,2.71H152a8,8,0,0,0-8,8v24a24,24,0,0,1-19.29,23.54L88,150.11V56H204a8,8,0,0,1,7.94,7l12,96A7.87,7.87,0,0,1,222,165.29Z"></path>
                                        </svg>
                                    </label>
                                </li>
                            </ul>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <!-- sldier products -->
        <div class="mt-12 md:mt-20 px-4 md:px-14">
            <!-- top slider -->
            <div class="flex gap-x-4 justify-between items-center mb-7">
                <div class="w-48 min-w-fit text-zinc-700 md:font-yekanBakhBold">
                    محصولات مرتبط
                </div>
                <div class="h-[1px] w-full bg-gradient-to-r from-white via-zinc-300 to-white">
                </div>
                <div class="w-32 min-w-fit text-left">
                    <a class="group transition flex items-center justify-center gap-x-1 md:gap-x-2 text-zinc-600 hover:text-primary-500 text-xs md:text-sm text-center"
                       href="">
                        مشاهده همه
                        <svg class="fill-zinc-600 group-hover:-translate-x-1 transition group-hover:fill-primary-500 size-2.5 md:size-3"
                             fill="" height="" viewbox="0 0 256 256" width="" xmlns="http://www.w3.org/2000/svg">
                            <path d="M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z"></path>
                        </svg>
                    </a>
                </div>
            </div>
            <!-- main slider -->
            <div class="containerPSlider swiper">
                <div class="productSlider1">
                    <div class="card-wrapper swiper-wrapper pb-10">
                        {% for related_product in related_products %}
                        <div class="card swiper-slide shiny my-2 p-2 md:p-4 hover:border-transparent hover:shadow-lg transition-shadow rounded-3xl border border-zinc-200 relative">
                            {% if user.is_authenticated %}
                            <a href="#" class="toggle-favorite" data-product-id="{{ related_product.id }}">
                                <svg class="absolute right-2 top-2 {% if related_product.id in user_favorites %}bg-red-500 fill-white{% else %}bg-white hover:bg-primary-500 hover:fill-white{% endif %} transition-all rounded-full p-2 border border-zinc-300 size-9 favorite-icon"
                                     fill="{% if related_product.id in user_favorites %}#ffffff{% else %}#000000{% endif %}" height="" viewbox="0 0 256 256" width=""
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path d="M178,32c-20.65,0-38.73,8.88-50,23.89C116.73,40.88,98.65,32,78,32A62.07,62.07,0,0,0,16,94c0,70,103.79,126.66,108.21,129a8,8,0,0,0,7.58,0C136.21,220.66,240,164,240,94A62.07,62.07,0,0,0,178,32ZM128,206.8C109.74,196.16,32,147.69,32,94A46.06,46.06,0,0,1,78,48c19.45,0,35.78,10.36,42.6,27a8,8,0,0,0,14.8,0c6.82-16.67,23.15-27,42.6-27a46.06,46.06,0,0,1,46,46C224,147.61,146.24,196.15,128,206.8Z"></path>
                                </svg>
                            </a>
                            {% endif %}
                            <a class="image-box mb-6 block py-10" href="{% url 'product' related_product.slug %}">
                                {% if related_product.images.first %}
                                <img alt="{{ related_product.title }}" class="max-w-40 mx-auto"
                                     src='{{ related_product.images.first.image.url }}'>
                                {% else %}
                                <img alt="{{ related_product.title }}" class="max-w-40 mx-auto"
                                     src='{% static "./assets/image/products/2.webp" %}'>
                                {% endif %}
                            </a>
                            <a class="text-sm font-semibold text-zinc-700 h-10 line-clamp-2"
                               href="{% url 'product' related_product.slug %}">
                                {{ related_product.title }}
                            </a>
                            <div class="border-b-2 border-dashed border-zinc-200 my-5 w-full h-auto"></div>
                            <div class="flex justify-between items-center">
                                {% if user.is_authenticated and related_product.stock > 0 %}
                                <button class="group/edit bg-primary-500 hover:bg-primary-400 px-5 md:px-2.5 py-2.5 rounded-xl shadow-lg transition-all add-to-cart-btn" data-product-id="{{ related_product.id }}">
                                    <svg class="stroke-white" fill="none" height="24" viewbox="0 0 24 24" width="24"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3.86399 16.455C4.40999 18.638 4.68299 19.729 5.49599 20.365C6.30999 21 7.43499 21 9.68499 21H14.315C16.565 21 17.69 21 18.505 20.365C19.318 19.729 19.591 18.638 20.136 16.455C20.994 13.023 21.423 11.308 20.523 10.154C19.622 9 17.853 9 14.316 9H9.68499C6.14699 9 4.37899 9 3.47799 10.154C2.94899 10.831 2.87799 11.702 3.08399 13"
                                              stroke="#" stroke-linecap="round" stroke-width="1.5"></path>
                                        <path d="M19.5 9.5L18.79 6.895C18.516 5.89 18.379 5.388 18.098 5.009C17.8178 4.63246 17.4373 4.3424 17 4.172C16.56 4 16.04 4 15 4M4.5 9.5L5.21 6.895C5.484 5.89 5.621 5.388 5.902 5.009C6.18218 4.63246 6.56269 4.3424 7 4.172C7.44 4 7.96 4 9 4"
                                              stroke="#" stroke-width="1.5"></path>
                                        <path d="M9 4C9 3.73478 9.10536 3.48043 9.29289 3.29289C9.48043 3.10536 9.73478 3 10 3H14C14.2652 3 14.5196 3.10536 14.7071 3.29289C14.8946 3.48043 15 3.73478 15 4C15 4.26522 14.8946 4.51957 14.7071 4.70711C14.5196 4.89464 14.2652 5 14 5H10C9.73478 5 9.48043 4.89464 9.29289 4.70711C9.10536 4.51957 9 4.26522 9 4Z"
                                              stroke="#" stroke-width="1.5"></path>
                                    </svg>
                                </button>
                                {% endif %}
                                <div class="flex">
                                    <div class="text-base md:text-xl">{{ related_product.price|floatformat:0 }}</div>
                                    <div class="-rotate-90 text-zinc-400 text-xs md:text-sm">
                                        تومان
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-span-full text-center py-12">
                            <p class="text-zinc-600 text-sm md:text-base">محصول مرتبطی یافت نشد.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        </div>
    </main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add to cart
    document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const productId = this.dataset.productId;
            addToCart(productId);
        });
    });
    
    // Toggle favorite
    const favoriteBtn = document.querySelector('.toggle-favorite');
    if (favoriteBtn) {
        favoriteBtn.addEventListener('click', function(e) {
            e.preventDefault();
            const productId = this.dataset.productId;
            toggleFavorite(productId);
        });
    }
    
    function addToCart(productId) {
        fetch('/cart/add/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `product_id=${productId}&quantity=1`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message || 'محصول به سبد خرید اضافه شد');
                // Update cart count if exists
                const cartCount = document.querySelector('.cart-count');
                if (cartCount) {
                    cartCount.textContent = data.cart_total || 0;
                }
            } else {
                alert(data.error || 'خطا در افزودن به سبد خرید');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('خطا در ارتباط با سرور');
        });
    }
    
    function toggleFavorite(productId) {
        fetch('/dashboard/favorites/toggle/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `product_id=${productId}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const icon = document.querySelector('.favorite-icon');
                const text = document.querySelector('.favorite-text');
                if (data.is_favorite) {
                    icon.classList.remove('fill-zinc-700');
                    icon.classList.add('fill-red-500');
                    if (text) text.textContent = 'حذف از علاقه‌مندی‌ها';
                } else {
                    icon.classList.remove('fill-red-500');
                    icon.classList.add('fill-zinc-700');
                    if (text) text.textContent = 'افزودن به علاقه‌مندی‌ها';
                }
            } else {
                alert(data.error || 'خطا در به‌روزرسانی علاقه‌مندی');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('خطا در ارتباط با سرور');
        });
    }
});
</script>
{% endblock %}